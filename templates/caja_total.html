
{% extends "base.html" %}
{% block title %}ğŸ“Š Caja Total{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2 class="mb-4 text-center">ğŸ’° Resumen Total de Caja</h2>

    <!-- ğŸ’¼ Caja disponible -->
    <div class="alert alert-info text-center fs-5 shadow-sm">
        <strong>ğŸ’¼ Caja Disponible:</strong>
        ${{ "%.2f"|format(caja_disponible) }}
    </div>

    <!-- ğŸ’µ Total acumulado histÃ³rico -->
    <div class="alert alert-success text-center fs-5 shadow-sm">
        <strong>Total Acumulado (sin descontar salidas):</strong>
        ${{ "%.2f"|format(total_global) }}
    </div>

    <!-- ğŸ“… Tabla de registros -->
    {% if registros %}
    <div class="table-responsive shadow-sm">
        <table class="table table-bordered table-hover text-center align-middle mb-0">
            <thead class="table-dark">
                <tr>
                    <th>ğŸ“… Fecha</th>
                    <th>ğŸ’µ Caja del DÃ­a</th>
                    <th>ğŸ·ï¸ Inventario</th>
                    <th>ğŸ” Detalle</th>
                </tr>
            </thead>
            <tbody>
                {% for r in registros %}
                <tr>
                    <td>{{ r.fecha.strftime("%d/%m/%Y") }}</td>
                    <td class="fw-bold {% if r.caja < 0 %}text-danger{% else %}text-success{% endif %}">
                        ${{ "%.2f"|format(r.caja or 0) }}
                    </td>
                    <td>${{ "%.2f"|format(r.inventario_valor or 0) }}</td>
                    <td>
                        <a href="{{ url_for('detalle_dia', fecha=r.fecha.strftime('%Y-%m-%d')) }}" 
                           class="btn btn-sm btn-outline-primary shadow-sm">
                           ğŸ“‹ Ver
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-warning text-center mt-3">âš ï¸ No hay registros de caja disponibles.</div>
    {% endif %}

    <!-- ğŸ’¸ BotÃ³n de liquidar caja total -->
    <div class="mt-4 d-flex flex-column flex-md-row justify-content-between align-items-center gap-3">
        <a href="{{ url_for('liquidacion') }}" class="btn btn-secondary px-4">
            â† Volver a LiquidaciÃ³n
        </a>

        <form action="{{ url_for('liquidar_caja_total') }}" method="POST"
              onsubmit="return confirm('âš ï¸ Â¿Seguro que deseas liquidar toda la caja acumulada? Esta acciÃ³n registrarÃ¡ una salida total, pero conservarÃ¡ todo el historial.');">
            <button type="submit" class="btn btn-danger fw-bold shadow-sm px-4">
                ğŸ’¸ Liquidar Caja Total
            </button>
        </form>
    </div>
</div>

<style>
.table th, .table td {
    vertical-align: middle !important;
}
.alert {
    border-radius: 10px;
}
.btn-danger {
    background: linear-gradient(135deg, #dc3545, #a71d2a);
    border: none;
    transition: 0.3s ease;
}
.btn-danger:hover {
    background: linear-gradient(135deg, #a71d2a, #dc3545);
    transform: scale(1.05);
}
@media (max-width: 768px) {
    h2 { font-size: 1.3rem; }
    .table { font-size: 0.9rem; }
    .btn-danger, .btn-secondary {
        width: 100%;
    }
}
</style>
{% endblock %}
