{% extends "base.html" %}
{% block title %}üìä Liquidaci√≥n de Productos{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="text-center mb-4">üìä Liquidaci√≥n de Productos</h2>

  <!-- üìÖ Selector de fechas -->
  <form method="POST" class="d-flex justify-content-center align-items-center gap-2 mb-4">
    <label for="fecha_inicio" class="fw-bold">Desde:</label>
    <input type="date" name="fecha_inicio" value="{{ fecha_inicio }}" class="form-control w-auto" required>
    <label for="fecha_fin" class="fw-bold">Hasta:</label>
    <input type="date" name="fecha_fin" value="{{ fecha_fin }}" class="form-control w-auto" required>
    <button type="submit" class="btn btn-primary">üîç Buscar</button>
  </form>

  <p class="text-center fw-bold mb-3">
    üóìÔ∏è √öltima liquidaci√≥n: {{ ultima_fecha.strftime("%d-%m-%Y") if ultima_fecha else "N/A" }}
  </p>

  {% if liquidaciones %}
  <div class="table-responsive">
    <table class="table table-bordered table-hover text-center align-middle shadow-sm">
      <thead class="table-dark">
        <tr>
          <th>Fecha</th>
          <th>Ingresos</th>
          <th>Caja anterior</th>
          <th>Entr.Efec.</th>
          <th>Ventas</th>
          <th>Gastos</th>
          <th>Salida efectivo</th>
          <th>Caja</th>
          <th>D√≠a tasado</th>
          <th>Suma Paquete</th>
        </tr>
      </thead>
      <tbody>
        {% for d in liquidaciones %}
        <tr>
          <td>{{ d.fecha.strftime("%d-%m-%Y") }}</td>
          <td>${{ "%.2f"|format(d.ingresos or 0) }}</td>
          <td>${{ "%.2f"|format(d.caja_anterior or 0) }}</td>
          <td>${{ "%.2f"|format(d.entrada_efectivo or 0) }}</td>
          <td>
            <a href="{{ url_for('app_rutas.detalle_ventas', fecha=d.fecha.strftime('%Y-%m-%d')) }}" class="fw-bold text-success text-decoration-none">
              ${{ "%.2f"|format(d.ventas_dia or 0) }}
            </a>
          </td>
          <td>${{ "%.2f"|format(d.gastos or 0) }}</td>
          <td>
            <a href="{{ url_for('app_rutas.detalle_salida', fecha=d.fecha.strftime('%Y-%m-%d')) }}" class="fw-bold text-danger text-decoration-none">
              ${{ "%.2f"|format(d.salida_efectivo or 0) }}
            </a>
          </td>
          <td class="fw-bold text-primary">${{ "%.2f"|format(d.caja or 0) }}</td>
          <td>${{ "%.2f"|format(d.dia_tasado or 0) }}</td>
          <td>${{ "%.2f"|format(d.suma_paquete or 0) }}</td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot class="table-light fw-bold">
        <tr>
          <td>Total</td>
          <td>${{ "%.2f"|format(total_ingresos or 0) }}</td>
          <td>${{ "%.2f"|format(caja_inicial or 0) }}</td>
          <td>${{ "%.2f"|format(total_ingresos or 0) }}</td>
          <td>${{ "%.2f"|format(total_ventas or 0) }}</td>
          <td>0.00</td>
          <td>${{ "%.2f"|format(total_salida or 0) }}</td>
          <td>${{ "%.2f"|format(caja_final or 0) }}</td>
          <td>${{ "%.2f"|format(total_dia_tasado or 0) }}</td>
          <td>${{ "%.2f"|format(total_paquete or 0) }}</td>
        </tr>
      </tfoot>
    </table>
  </div>
  {% else %}
  <div class="alert alert-info text-center">No se encontraron registros de liquidaci√≥n.</div>
  {% endif %}
</div>
{% endblock %}
